<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Products List</title>
</head>
<body>
  <h1>Products</h1>

  <label for="accountSelect">Escolha a conta:</label>
<select id="accountSelect">
  <option value="">Todas as contas</option>
</select>

<br><br>

  <ul id="productList"></ul>

  <h1>Category Profits</h1>
<table border="1" cellpadding="5">
  <thead>
    <tr>
      <th>ID</th>
      <th>Categoria</th>
      <th>Lucro</th>
    </tr>
  </thead>
  <tbody id="profitTable"></tbody>
</table>

  <script>

    /*
    async function loadProducts() {
      const res = await fetch("/api/products");
      const products = await res.json();

      const ul = document.getElementById("productList");
      products.forEach(p => {
        const li = document.createElement("li");
        li.textContent = `${p.product_id} - ${p.product_name}`;
        ul.appendChild(li);
      });
    }

    loadProducts();
    */

    async function loadAccounts() {
      const res = await fetch("/api/accounts");
      const accounts = await res.json();

      const select = document.getElementById("accountSelect");

      accounts.forEach(acc => {
        const option = document.createElement("option");
        option.value = acc.ccusto;
        option.textContent = acc.ccusto;
        select.appendChild(option);
      });
    }



    async function loadCategoryProfits(account = "") {

      let url = "/api/categories-profit";
      if (account) url += `?account=${account}`;

      const res = await fetch(url);
      const data = await res.json();

      const tbody = document.getElementById("profitTable");
      tbody.innerHTML = ""; // Clear table to refresh

      data.forEach(row => {
        const tr = document.createElement("tr");

        tr.innerHTML = `
          <td>${row.id_da_categoria}</td>
          <td>${row.categoria}</td>
          <td>${row.profit}</td>
        `;

        tbody.appendChild(tr);
      });
    }

    document.getElementById("accountSelect").addEventListener("change", (e) => {
      loadCategoryProfits(e.target.value);
    });

    loadAccounts();
    loadCategoryProfits();

  </script>
</body>
</html>
